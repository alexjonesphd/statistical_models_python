
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Fitting latent groups in data - Exercises &amp; Answers &#8212; Statistical Modelling with Python</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = '10_Clustering/QPoP - Week 10 Exercises - Answers';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="10 - Clustering" href="QPoP%20-%20Week%2010%20Workshop.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Statistical Modelling with Python - Home"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Statistical Modelling with Python - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Statistical Modelling with Python
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Python Basics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../1_Introduction/QPoP%20-%20Week%201%20Workshop.html">1 - Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_Introduction/QPoP%20-%20Week%201%20Exercises%20-%20Answers.html">Using Python for Data Analysis - Exercises &amp; Answers</a></li>






</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">The GLM</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../2_The_GLM/QPoP%20-%20Week%202%20Workshop.html">2 - The General Linear Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_The_GLM/QPoP%20-%20Week%202%20Exercises%20-%20Answers.html">Getting to grips with linear models in Python - Exercises &amp; Answers</a></li>



</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Advancing the GLM</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../3_Advancing_GLM/QPoP%20-%20Week%203%20Workshop.html">3 - Advancing the general linear model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_Advancing_GLM/QPoP%20-%20Week%203%20Exercises%20-%20Answers.html">Checking assumptions and including interactions - Exercises &amp; Answers</a></li>


</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">The art of prediction</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../4_Prediction/QPoP%20-%20Week%204%20Workshop.html">4 - The art of prediction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4_Prediction/QPoP%20-%20Week%204%20Exercises%20-%20Answers.html">Asking scientific questions of models - Exercises &amp; Answers</a></li>

</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Binary outcome models</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../5_Binary/QPoP%20-%20Week%205%20Workshop.html">5 - Binary outcome models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../5_Binary/QPoP%20-%20Week%205%20Exercises%20-%20Answers.html">Using and understanding probit models - Exercises &amp; Answers</a></li>



</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Applications and other kinds of hypotheses</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../6_Applications/QPoP%20-%20Week%206%20Workshop.html">6 - Precision in Predictions</a></li>




<li class="toctree-l1"><a class="reference internal" href="../6_Applications/QPoP%20-%20Week%206%20Exercises%20-%20Answers.html">Example exercises using skills so far</a></li>



</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Linear Mixed Effects Models</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../7_MixedModel/QPoP%20-%20Week%207%20Workshop.html">7 - Linear mixed effects models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../7_MixedModel/QPoP%20-%20Week%207%20Exercises%20-%20Answers.html">Dealing with repeated measurements - Exercises &amp; Answers</a></li>




</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Exploratory Factor Analysis</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../8_EFA/QPoP%20-%20Week%208%20Workshop.html">8 - Exploratory Factor Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_EFA/QPoP%20-%20Week%208%20Exercises%20-%20Answers.html">Finding latent variables in data - Exercises &amp; Answers</a></li>


</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Confirmatory Factor Analysis</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../9_CFA/QPoP%20-%20Week%209%20Workshop.html">9 - Confirmatory Factor Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../9_CFA/QPoP%20-%20Week%209%20Exercises%20-%20Answers.html">Fitting latent variables onto data - Exercises &amp; Answers</a></li>







</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Clustering</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="QPoP%20-%20Week%2010%20Workshop.html">10 - Clustering</a></li>

<li class="toctree-l1 current active"><a class="current reference internal" href="#">Fitting latent groups in data - Exercises &amp; Answers</a></li>



</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2F10_Clustering/QPoP - Week 10 Exercises - Answers.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/10_Clustering/QPoP - Week 10 Exercises - Answers.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Fitting latent groups in data - Exercises & Answers</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Fitting latent groups in data - Exercises &amp; Answers</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#applied-clustering-types-of-fertility-issues">1. Applied clustering - types of fertility issues</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#applied-clustering-grouping-penguins">2. Applied clustering - grouping penguins</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#applied-clustering-combining-efa-and-clustering">3. Applied clustering - combining EFA and clustering</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="fitting-latent-groups-in-data-exercises-answers">
<h1>Fitting latent groups in data - Exercises &amp; Answers<a class="headerlink" href="#fitting-latent-groups-in-data-exercises-answers" title="Link to this heading">#</a></h1>
</section>
<section id="applied-clustering-types-of-fertility-issues">
<h1>1. Applied clustering - types of fertility issues<a class="headerlink" href="#applied-clustering-types-of-fertility-issues" title="Link to this heading">#</a></h1>
<p>With a clustering algorithm under our belts, lets apply it to a real dataset. We’ll investigate whether sub-groups exist in a dataset of females having difficulty conceiving. This might offer some insight into different treatment approaches.</p>
<p>First, import everything we need. This includes the silhoette score and clustering functionality.</p>
<p>Also import <code class="docutils literal notranslate"><span class="pre">matplotlib.pyplot</span> <span class="pre">as</span> <span class="pre">plt</span></code> and the <code class="docutils literal notranslate"><span class="pre">zscore</span></code> function from <code class="docutils literal notranslate"><span class="pre">scipy.stats</span></code>.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Your answer here</span>
<span class="c1"># Import what we need</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span> <span class="c1"># dataframes</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span> <span class="c1"># plots</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span> <span class="c1"># numpy for some functions</span>
<span class="kn">import</span> <span class="nn">scipy.cluster.hierarchy</span> <span class="k">as</span> <span class="nn">shc</span> <span class="c1"># clustering</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span> <span class="c1"># extra plotting functions</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">zscore</span> <span class="c1"># Z-score</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">silhouette_score</span>

<span class="n">sns</span><span class="o">.</span><span class="n">set_theme</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;whitegrid&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>Next, read in the data from the following link into a dataframe called <code class="docutils literal notranslate"><span class="pre">fertility</span></code>, showing the top 10 rows: <a class="reference external" href="https://vincentarelbundock.github.io/Rdatasets/csv/Stat2Data/Fertility.csv">https://vincentarelbundock.github.io/Rdatasets/csv/Stat2Data/Fertility.csv</a></p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Your answer here</span>
<span class="n">fertility</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://vincentarelbundock.github.io/Rdatasets/csv/Stat2Data/Fertility.csv&#39;</span><span class="p">)</span>
<span class="n">fertility</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>rownames</th>
      <th>Age</th>
      <th>LowAFC</th>
      <th>MeanAFC</th>
      <th>FSH</th>
      <th>E2</th>
      <th>MaxE2</th>
      <th>MaxDailyGn</th>
      <th>TotalGn</th>
      <th>Oocytes</th>
      <th>Embryos</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>40</td>
      <td>40</td>
      <td>51.5</td>
      <td>5.3</td>
      <td>45</td>
      <td>1427</td>
      <td>300.0</td>
      <td>2700.0</td>
      <td>25</td>
      <td>13</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>37</td>
      <td>41</td>
      <td>41.0</td>
      <td>7.1</td>
      <td>53</td>
      <td>802</td>
      <td>225.0</td>
      <td>1800.0</td>
      <td>7</td>
      <td>6</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>40</td>
      <td>38</td>
      <td>41.0</td>
      <td>4.9</td>
      <td>40</td>
      <td>4533</td>
      <td>450.0</td>
      <td>4850.0</td>
      <td>27</td>
      <td>15</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>40</td>
      <td>36</td>
      <td>37.5</td>
      <td>3.9</td>
      <td>26</td>
      <td>1804</td>
      <td>300.0</td>
      <td>2700.0</td>
      <td>9</td>
      <td>4</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>30</td>
      <td>36</td>
      <td>36.0</td>
      <td>4.0</td>
      <td>49</td>
      <td>2526</td>
      <td>150.0</td>
      <td>1500.0</td>
      <td>19</td>
      <td>12</td>
    </tr>
    <tr>
      <th>5</th>
      <td>6</td>
      <td>29</td>
      <td>35</td>
      <td>35.0</td>
      <td>3.9</td>
      <td>67</td>
      <td>3812</td>
      <td>150.0</td>
      <td>975.0</td>
      <td>19</td>
      <td>16</td>
    </tr>
    <tr>
      <th>6</th>
      <td>7</td>
      <td>31</td>
      <td>24</td>
      <td>35.0</td>
      <td>3.8</td>
      <td>49</td>
      <td>1087</td>
      <td>262.5</td>
      <td>2512.5</td>
      <td>13</td>
      <td>9</td>
    </tr>
    <tr>
      <th>7</th>
      <td>8</td>
      <td>33</td>
      <td>28</td>
      <td>34.0</td>
      <td>4.3</td>
      <td>20</td>
      <td>1615</td>
      <td>375.0</td>
      <td>3075.0</td>
      <td>15</td>
      <td>9</td>
    </tr>
    <tr>
      <th>8</th>
      <td>9</td>
      <td>36</td>
      <td>30</td>
      <td>33.0</td>
      <td>4.9</td>
      <td>60</td>
      <td>1879</td>
      <td>300.0</td>
      <td>4800.0</td>
      <td>23</td>
      <td>10</td>
    </tr>
    <tr>
      <th>9</th>
      <td>10</td>
      <td>35</td>
      <td>32</td>
      <td>32.0</td>
      <td>3.7</td>
      <td>36</td>
      <td>2009</td>
      <td>225.0</td>
      <td>1275.0</td>
      <td>26</td>
      <td>8</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>What do these variables mean? The dataset description gives us the following:</p>
<ul class="simple">
<li><p><strong>Age</strong>	Age (in years)</p></li>
<li><p><strong>LowAFC</strong>	Smallest antral follicle count</p></li>
<li><p><strong>MeanAFC</strong>	Average antral follicle count</p></li>
<li><p><strong>FSH</strong>	Maximum follicle stimulating hormone level</p></li>
<li><p><strong>E2</strong>	Estradiol level</p></li>
<li><p><strong>MaxE2</strong>	Maximum estradiol level</p></li>
<li><p><strong>MaxDailyGn</strong>	Maximum daily gonadotropin level</p></li>
<li><p><strong>TotalGn</strong>	Total gonadotropin level</p></li>
<li><p><strong>Oocytes</strong>	Number of egg cells</p></li>
<li><p><strong>Embryos</strong>	Number of embryos</p></li>
</ul>
<p>These variables all contribute to the probability of conception in one way or another, and they are all on different scales. We will standardise each variable with Z-scores. Apply the z-score function to all variables EXCEPT the <code class="docutils literal notranslate"><span class="pre">rownames</span></code> column, which you should simply drop, and display the data to check it has all worked.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Your answer here</span>
<span class="c1"># Drop the column</span>
<span class="n">fertility</span> <span class="o">=</span> <span class="n">fertility</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;rownames&#39;</span><span class="p">)</span>

<span class="c1"># Apply the z-score function</span>
<span class="n">fertility</span> <span class="o">=</span> <span class="n">fertility</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">zscore</span><span class="p">)</span>

<span class="c1"># Show</span>
<span class="n">display</span><span class="p">(</span><span class="n">fertility</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Age</th>
      <th>LowAFC</th>
      <th>MeanAFC</th>
      <th>FSH</th>
      <th>E2</th>
      <th>MaxE2</th>
      <th>MaxDailyGn</th>
      <th>TotalGn</th>
      <th>Oocytes</th>
      <th>Embryos</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.994801</td>
      <td>4.010100</td>
      <td>5.119848</td>
      <td>-0.327405</td>
      <td>0.246933</td>
      <td>-0.152764</td>
      <td>-0.093209</td>
      <td>-0.095492</td>
      <td>2.229576</td>
      <td>1.539390</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.355286</td>
      <td>4.154807</td>
      <td>3.704057</td>
      <td>0.600475</td>
      <td>0.773195</td>
      <td>-0.954406</td>
      <td>-0.742011</td>
      <td>-0.752558</td>
      <td>-0.819495</td>
      <td>-0.178330</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.994801</td>
      <td>3.720684</td>
      <td>3.704057</td>
      <td>-0.533600</td>
      <td>-0.081982</td>
      <td>3.831078</td>
      <td>1.204394</td>
      <td>1.474166</td>
      <td>2.568361</td>
      <td>2.030167</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.994801</td>
      <td>3.431269</td>
      <td>3.232127</td>
      <td>-1.049089</td>
      <td>-1.002942</td>
      <td>0.330787</td>
      <td>-0.093209</td>
      <td>-0.095492</td>
      <td>-0.480709</td>
      <td>-0.669108</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-1.136915</td>
      <td>3.431269</td>
      <td>3.029871</td>
      <td>-0.997540</td>
      <td>0.510064</td>
      <td>1.256844</td>
      <td>-1.390813</td>
      <td>-0.971579</td>
      <td>1.213219</td>
      <td>1.294001</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>328</th>
      <td>1.421144</td>
      <td>-1.488795</td>
      <td>-1.554597</td>
      <td>5.188323</td>
      <td>-1.858119</td>
      <td>-1.060864</td>
      <td>1.204394</td>
      <td>1.875706</td>
      <td>-1.158281</td>
      <td>-0.669108</td>
    </tr>
    <tr>
      <th>329</th>
      <td>2.273831</td>
      <td>-1.488795</td>
      <td>-1.554597</td>
      <td>1.786098</td>
      <td>1.562590</td>
      <td>-0.506769</td>
      <td>1.204394</td>
      <td>0.890107</td>
      <td>-0.819495</td>
      <td>-1.159885</td>
    </tr>
    <tr>
      <th>330</th>
      <td>0.994801</td>
      <td>-1.778211</td>
      <td>-1.824271</td>
      <td>-0.533600</td>
      <td>-0.410896</td>
      <td>2.601038</td>
      <td>0.555593</td>
      <td>0.671085</td>
      <td>0.535648</td>
      <td>-0.423719</td>
    </tr>
    <tr>
      <th>331</th>
      <td>0.142114</td>
      <td>-1.778211</td>
      <td>-1.824271</td>
      <td>0.084986</td>
      <td>0.378498</td>
      <td>-0.441355</td>
      <td>1.204394</td>
      <td>1.766195</td>
      <td>0.196862</td>
      <td>0.067058</td>
    </tr>
    <tr>
      <th>332</th>
      <td>-0.071057</td>
      <td>1.405360</td>
      <td>1.142149</td>
      <td>-0.945991</td>
      <td>-0.279330</td>
      <td>0.153784</td>
      <td>-1.390813</td>
      <td>-1.300112</td>
      <td>-0.311317</td>
      <td>-0.669108</td>
    </tr>
  </tbody>
</table>
<p>333 rows × 10 columns</p>
</div></div></div>
</div>
<p>Next, compute the linkage array, which builds the tree. Then, visualise it with a dendrogram.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Your answer here</span>
<span class="c1"># Compute tree</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">shc</span><span class="o">.</span><span class="n">linkage</span><span class="p">(</span><span class="n">fertility</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;ward&#39;</span><span class="p">)</span>

<span class="c1"># Visualise</span>
<span class="n">dendrogram</span> <span class="o">=</span> <span class="n">shc</span><span class="o">.</span><span class="n">dendrogram</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">no_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/890c6253288cde004e57816ea07490641e495a50149e8d25f10cebda847ab4db.png" src="../_images/890c6253288cde004e57816ea07490641e495a50149e8d25f10cebda847ab4db.png" />
</div>
</div>
<p>This suggests an the possibility of several cluster arrangements - certainly two (e.g., cut at 25), three, four, or even five.</p>
<p>Evaluate the silhouette score of the two and three cluster solution by cutting the tree at an appropriate height, recovering the labels, and using the silhouette score function.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Your answer here</span>
<span class="c1"># Get two and three cuts</span>
<span class="n">cluster_2</span> <span class="o">=</span> <span class="n">shc</span><span class="o">.</span><span class="n">cut_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
<span class="n">cluster_3</span> <span class="o">=</span> <span class="n">shc</span><span class="o">.</span><span class="n">cut_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">23</span><span class="p">)</span>

<span class="c1"># Evaluate </span>
<span class="n">silhouette_2</span> <span class="o">=</span> <span class="n">silhouette_score</span><span class="p">(</span><span class="n">fertility</span><span class="p">,</span> <span class="n">cluster_2</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
<span class="n">silhouette_3</span> <span class="o">=</span> <span class="n">silhouette_score</span><span class="p">(</span><span class="n">fertility</span><span class="p">,</span> <span class="n">cluster_3</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>

<span class="c1"># Print</span>
<span class="n">display</span><span class="p">(</span><span class="n">silhouette_2</span><span class="p">,</span> <span class="n">silhouette_3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.2146644461574779
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.18422376524085038
</pre></div>
</div>
</div>
</div>
<p>We should see that the clustering suggests two clusters, but that they are not particularly strong. Put those cluster labels into the dataset, call the column ‘cluster’.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Your answer here</span>
<span class="n">fertility</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cluster_2</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>We will now visualise the clusters to see what the pattern looks like. Reset the dataframe index, then melt the data appropriately so it can be plotted with a barplot. Use <code class="docutils literal notranslate"><span class="pre">catplot</span></code> to separate the plots by cluster.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Your answer here</span>
<span class="c1"># Melt the data</span>
<span class="n">plot_this</span> <span class="o">=</span> <span class="p">(</span><span class="n">fertility</span>
             <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
             <span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="s1">&#39;cluster&#39;</span><span class="p">],</span>
                   <span class="n">var_name</span><span class="o">=</span><span class="s1">&#39;measure&#39;</span><span class="p">,</span> 
                   <span class="n">value_name</span><span class="o">=</span><span class="s1">&#39;score&#39;</span><span class="p">)</span>
            <span class="p">)</span>

<span class="c1"># Plot</span>
<span class="n">sns</span><span class="o">.</span><span class="n">catplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">plot_this</span><span class="p">,</span> 
            <span class="n">aspect</span><span class="o">=</span><span class="mf">1.1</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
            <span class="n">x</span><span class="o">=</span><span class="s1">&#39;measure&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;score&#39;</span><span class="p">,</span>
            <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;measure&#39;</span><span class="p">,</span>
            <span class="n">col</span><span class="o">=</span><span class="s1">&#39;cluster&#39;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;seaborn.axisgrid.FacetGrid at 0x146171110&gt;
</pre></div>
</div>
<img alt="../_images/3bb3fa7dc6a44f3f8750c478a679a228030af5d89ed121635d260e8e58a98dbd.png" src="../_images/3bb3fa7dc6a44f3f8750c478a679a228030af5d89ed121635d260e8e58a98dbd.png" />
</div>
</div>
<p>There is a clear pattern in this.</p>
<ul class="simple">
<li><p>Cluster zero contains females who are younger than average, with higher antrical follicle counts but low follice stimulating hormone (FSH) and circulating estradiol. They have low gonadotropin levels and high numbers of oocytes and embryos.</p></li>
<li><p>However, cluster one has females who are essentially the opposite - older, with lower number of embryos and oocytes, and higher levels of gonadotropin and follicular stimulating hormone and estradiol.</p></li>
</ul>
<p>These findings would need further replication and investigation but point towards (weaker) subgroups in the data.</p>
</section>
<section id="applied-clustering-grouping-penguins">
<h1>2. Applied clustering - grouping penguins<a class="headerlink" href="#applied-clustering-grouping-penguins" title="Link to this heading">#</a></h1>
<p>We return to another dataset we have seen earlier in the course - the <code class="docutils literal notranslate"><span class="pre">penguins</span></code> dataset. This dataset contains four measurements of three types of penguins, found across three different islands. We will see here if the hierarchical clustering approach can divide the dataset into clusters that resemble the different species. First, we can load the dataset directly from <code class="docutils literal notranslate"><span class="pre">seaborn</span></code>, using its <code class="docutils literal notranslate"><span class="pre">load_dataset</span></code> function - refer to chapter one for a refresher! Load it into a dataframe called <code class="docutils literal notranslate"><span class="pre">penguins</span></code>. Show the top 5 rows.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Your answer here</span>
<span class="n">penguins</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">load_dataset</span><span class="p">(</span><span class="s1">&#39;penguins&#39;</span><span class="p">)</span>
<span class="n">penguins</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>species</th>
      <th>island</th>
      <th>bill_length_mm</th>
      <th>bill_depth_mm</th>
      <th>flipper_length_mm</th>
      <th>body_mass_g</th>
      <th>sex</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Adelie</td>
      <td>Torgersen</td>
      <td>39.1</td>
      <td>18.7</td>
      <td>181.0</td>
      <td>3750.0</td>
      <td>Male</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Adelie</td>
      <td>Torgersen</td>
      <td>39.5</td>
      <td>17.4</td>
      <td>186.0</td>
      <td>3800.0</td>
      <td>Female</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Adelie</td>
      <td>Torgersen</td>
      <td>40.3</td>
      <td>18.0</td>
      <td>195.0</td>
      <td>3250.0</td>
      <td>Female</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Adelie</td>
      <td>Torgersen</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Adelie</td>
      <td>Torgersen</td>
      <td>36.7</td>
      <td>19.3</td>
      <td>193.0</td>
      <td>3450.0</td>
      <td>Female</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Drop any rows that have NaN in them.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Your answer here</span>
<span class="n">penguins</span> <span class="o">=</span> <span class="n">penguins</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>Replace the <code class="docutils literal notranslate"><span class="pre">bill_length_mm</span></code>, <code class="docutils literal notranslate"><span class="pre">bill_depth_mm</span></code>, <code class="docutils literal notranslate"><span class="pre">flipper_length_mm</span></code>, and <code class="docutils literal notranslate"><span class="pre">body_mass_g</span></code> variables with Z-scored versions.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Your answer here</span>
<span class="n">variables</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;bill_length_mm&#39;</span><span class="p">,</span> <span class="s1">&#39;bill_depth_mm&#39;</span><span class="p">,</span> <span class="s1">&#39;flipper_length_mm&#39;</span><span class="p">,</span> <span class="s1">&#39;body_mass_g&#39;</span><span class="p">]</span>
<span class="n">penguins</span><span class="p">[</span><span class="n">variables</span><span class="p">]</span> <span class="o">=</span> <span class="n">penguins</span><span class="p">[</span><span class="n">variables</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">zscore</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>Build the tree on those z-scored variables, and show the dendrogram.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Your answer here</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">shc</span><span class="o">.</span><span class="n">linkage</span><span class="p">(</span><span class="n">penguins</span><span class="p">[</span><span class="n">variables</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;ward&#39;</span><span class="p">)</span>

<span class="c1"># Show dendrogram</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">dendrogram</span> <span class="o">=</span> <span class="n">shc</span><span class="o">.</span><span class="n">dendrogram</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">no_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/fe3c0163c5bacfae22021a5e6de5902f73366531a654a4954d1d0fdc1b733468.png" src="../_images/fe3c0163c5bacfae22021a5e6de5902f73366531a654a4954d1d0fdc1b733468.png" />
</div>
</div>
<p>That is an interesting and very clean clustering solution. A cut at 10 would produce 5 clusters, while 15 would offer 3 clusters. More dramatically a cut at 20 would produce 2. Try those three solutions and assess their silhouette coefficient.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Your answer here</span>
<span class="c1"># Make cuts</span>
<span class="n">cluster_5</span> <span class="o">=</span> <span class="n">shc</span><span class="o">.</span><span class="n">cut_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">cluster_3</span> <span class="o">=</span> <span class="n">shc</span><span class="o">.</span><span class="n">cut_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">cluster_2</span> <span class="o">=</span> <span class="n">shc</span><span class="o">.</span><span class="n">cut_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="c1"># Silhouette</span>
<span class="n">silhouette_5</span> <span class="o">=</span> <span class="n">silhouette_score</span><span class="p">(</span><span class="n">penguins</span><span class="p">[</span><span class="n">variables</span><span class="p">],</span> <span class="n">cluster_5</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
<span class="n">silhouette_3</span> <span class="o">=</span> <span class="n">silhouette_score</span><span class="p">(</span><span class="n">penguins</span><span class="p">[</span><span class="n">variables</span><span class="p">],</span> <span class="n">cluster_3</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
<span class="n">silhouette_2</span> <span class="o">=</span> <span class="n">silhouette_score</span><span class="p">(</span><span class="n">penguins</span><span class="p">[</span><span class="n">variables</span><span class="p">],</span> <span class="n">cluster_2</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>

<span class="c1"># Print</span>
<span class="n">display</span><span class="p">(</span><span class="n">silhouette_5</span><span class="p">,</span> <span class="n">silhouette_3</span><span class="p">,</span> <span class="n">silhouette_2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.36144263075820016
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.4520982949638114
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.5308173701641075
</pre></div>
</div>
</div>
</div>
<p>These are generally stronger clusters compared to the previous example, as can be seen both from the dendrogram and the silhouette scores. It seems like 2 clusters offer a notably stronger solution, so we will take that, and add it to the dataset.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Your answer here</span>
<span class="n">penguins</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cluster_2</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>Use <code class="docutils literal notranslate"><span class="pre">pandas</span></code> compute the number of actual penguin species (in the <code class="docutils literal notranslate"><span class="pre">species</span></code> column) that are in the different clusters.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Your answer here</span>
<span class="n">pd</span><span class="o">.</span><span class="n">crosstab</span><span class="p">(</span><span class="n">penguins</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">],</span> <span class="n">penguins</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>cluster</th>
      <th>0</th>
      <th>1</th>
    </tr>
    <tr>
      <th>species</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Adelie</th>
      <td>146</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Chinstrap</th>
      <td>68</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Gentoo</th>
      <td>0</td>
      <td>119</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>This is about as clean a clustering solution as we’d hope to see in real data. The Adelie and Chinstrap penguins fall in one cluster, while the Gentoo are in another, with perfect separation. To assess this visually, what we will do next is melt the data so we can plot it, and then see what the clusters <em>and actual species</em> labels look like. First, reshape the data appropriately, keeping the clusters and species in the right spot and the measures as the variable.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Your answer here</span>
<span class="n">plot_this</span> <span class="o">=</span> <span class="n">penguins</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">,</span> <span class="s1">&#39;island&#39;</span><span class="p">,</span> <span class="s1">&#39;sex&#39;</span><span class="p">,</span> <span class="s1">&#39;cluster&#39;</span><span class="p">],</span>
                          <span class="n">value_vars</span><span class="o">=</span><span class="n">variables</span><span class="p">,</span>
                          <span class="n">var_name</span><span class="o">=</span><span class="s1">&#39;measure&#39;</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s1">&#39;score&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>Now create a bar plot that has on the x-axis the measure, with separate colours for each <em>species</em>.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Your answer here</span>
<span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">plot_this</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;measure&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;score&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;species&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: xlabel=&#39;measure&#39;, ylabel=&#39;score&#39;&gt;
</pre></div>
</div>
<img alt="../_images/23120e4071d972bef8b45e3053f9f1532eed0fe3f0a3294c8da6f97230534db0.png" src="../_images/23120e4071d972bef8b45e3053f9f1532eed0fe3f0a3294c8da6f97230534db0.png" />
</div>
</div>
<p>This shows the actual biological pattern. Adelie’s have shorter bills than Chinstrap and Gentoo penguins, but on the rest of the variables, the Gentoo’s are very dissimilar. Now create a bar plot that illustrates the <em>clusters</em> in the same way.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Your answer here</span>
<span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">plot_this</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;measure&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;score&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;cluster&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: xlabel=&#39;measure&#39;, ylabel=&#39;score&#39;&gt;
</pre></div>
</div>
<img alt="../_images/e3010f7c1d27b5c7a58e32f78877cf7f0b536e723d05587e344df13aa5c3545c.png" src="../_images/e3010f7c1d27b5c7a58e32f78877cf7f0b536e723d05587e344df13aa5c3545c.png" />
</div>
</div>
<p>From this its hopefully clear that the clustering algorithm has noticed the Gentoo penguins are so different on the other variables and has considered them to be a ‘different sort’ of penguin - the pattern closely resembles the actual biological speciation!</p>
</section>
<section id="applied-clustering-combining-efa-and-clustering">
<h1>3. Applied clustering - combining EFA and clustering<a class="headerlink" href="#applied-clustering-combining-efa-and-clustering" title="Link to this heading">#</a></h1>
<p>We turn now to a more advanced task, but one that in practice is often used and is very powerful. So far, we have used clustering on datasets with a relatively small number of variables (i.e., columns) of no more than 10 variables. One interesting mathematical issue is that as the number of variables increases, clusters become harder and harder to find due to the <em>curse of dimensionality</em> - each observation is almost equally far away from other points when there are many, many variables.</p>
<p>Fortunately we can solve this problem easily. We already know how. EFA allows us to reduce a large number of variables (e.g. scores on individual personality questions etc) to a smaller set, keeping a portion of the variance in the dataset. Carrying out clustering on the latent variables themselves and not the observed variables can offer some really interesting insights into a dataset. Here, we will use this approach to figure out if there are a set of ‘personality profiles’ in a Big 5 dataset we have seen before!</p>
<p>We will read in some raw Big 5 questionnaire data from this link: <a class="reference external" href="https://vincentarelbundock.github.io/Rdatasets/csv/psych/bfi.csv">https://vincentarelbundock.github.io/Rdatasets/csv/psych/bfi.csv</a></p>
<p>We’ve seen this before - read it in, and drop any missing data.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Your answer here</span>
<span class="n">bfi</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://vincentarelbundock.github.io/Rdatasets/csv/psych/bfi.csv&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">)</span>
<span class="n">bfi</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>rownames</th>
      <th>A1</th>
      <th>A2</th>
      <th>A3</th>
      <th>A4</th>
      <th>A5</th>
      <th>C1</th>
      <th>C2</th>
      <th>C3</th>
      <th>C4</th>
      <th>...</th>
      <th>N4</th>
      <th>N5</th>
      <th>O1</th>
      <th>O2</th>
      <th>O3</th>
      <th>O4</th>
      <th>O5</th>
      <th>gender</th>
      <th>education</th>
      <th>age</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>5</th>
      <td>61623</td>
      <td>6.0</td>
      <td>6.0</td>
      <td>5.0</td>
      <td>6.0</td>
      <td>5.0</td>
      <td>6.0</td>
      <td>6.0</td>
      <td>6.0</td>
      <td>1.0</td>
      <td>...</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>3</td>
      <td>5.0</td>
      <td>6.0</td>
      <td>1.0</td>
      <td>2</td>
      <td>3.0</td>
      <td>21</td>
    </tr>
    <tr>
      <th>7</th>
      <td>61629</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>5.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>...</td>
      <td>6.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>2</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>1</td>
      <td>2.0</td>
      <td>19</td>
    </tr>
    <tr>
      <th>10</th>
      <td>61634</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>6.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>...</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>3</td>
      <td>5.0</td>
      <td>6.0</td>
      <td>3.0</td>
      <td>1</td>
      <td>1.0</td>
      <td>21</td>
    </tr>
    <tr>
      <th>14</th>
      <td>61640</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>...</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>2</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>1</td>
      <td>1.0</td>
      <td>17</td>
    </tr>
    <tr>
      <th>22</th>
      <td>61661</td>
      <td>1.0</td>
      <td>5.0</td>
      <td>6.0</td>
      <td>5.0</td>
      <td>6.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>...</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>6.0</td>
      <td>1</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>1</td>
      <td>5.0</td>
      <td>68</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 29 columns</p>
</div></div></div>
</div>
<p>Now select only the questions that are relevant to the questionnaire - e.g. columns like ‘A1’, ‘N5’, etc. There should be 25 of those.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Your answer here</span>
<span class="n">bfi</span> <span class="o">=</span> <span class="n">bfi</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="s1">&#39;[A-Z]\d&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>We <em>could</em> cluster this, but it would likely be suboptimal. So first, we will conduct an EFA to reduce the 25 variables to 5 latent factors. Do this below, importing what you need to conduct it. Check the amount of variance retained also.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Your answer here</span>
<span class="c1"># Import factor analyzer</span>
<span class="kn">from</span> <span class="nn">factor_analyzer</span> <span class="kn">import</span> <span class="n">FactorAnalyzer</span>

<span class="c1"># Fit the model</span>
<span class="n">efa</span> <span class="o">=</span> <span class="n">FactorAnalyzer</span><span class="p">(</span><span class="n">n_factors</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">bfi</span><span class="p">)</span>

<span class="c1"># Get variances</span>
<span class="n">efa</span><span class="o">.</span><span class="n">get_factor_variance</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(array([2.71289544, 2.5194412 , 2.02988607, 1.57809897, 1.48183355]),
 array([0.10851582, 0.10077765, 0.08119544, 0.06312396, 0.05927334]),
 array([0.10851582, 0.20929347, 0.29048891, 0.35361287, 0.41288621]))
</pre></div>
</div>
</div>
</div>
<p>Check the loadings matrix and plot them, to confirm this is a good solution.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Your answer here</span>
<span class="n">loadings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">efa</span><span class="o">.</span><span class="n">loadings_</span><span class="p">,</span>
                        <span class="n">index</span><span class="o">=</span><span class="n">bfi</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

<span class="c1"># Plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">loadings</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: &gt;
</pre></div>
</div>
<img alt="../_images/2ddfd2d776f70d256c71b9a0dcfa88f17a484b3f484f469b75b124a7a9ef3647.png" src="../_images/2ddfd2d776f70d256c71b9a0dcfa88f17a484b3f484f469b75b124a7a9ef3647.png" />
</div>
</div>
<p>This does indeed look like a solid representation of the Big 5 - factor 0 is Neuroticism, factor 1 is Extraversion, factor 2 is Conscientiousness, factor 3 is Agreeableness, and factor 4 is Openness. Next, create a dataframe that has the latent scores of each participant on each factor (refer to chapter 8 for a refresher!), giving the column names in that order (N, E, C, A, O).</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Your answer here</span>
<span class="n">five</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">efa</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">bfi</span><span class="p">),</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">])</span>

<span class="n">five</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>N</th>
      <th>E</th>
      <th>A</th>
      <th>C</th>
      <th>O</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.026466</td>
      <td>1.243956</td>
      <td>1.425221</td>
      <td>0.150861</td>
      <td>0.400030</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.578565</td>
      <td>-1.826086</td>
      <td>-1.283536</td>
      <td>-2.161121</td>
      <td>-0.574579</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-0.166427</td>
      <td>0.199434</td>
      <td>-0.180815</td>
      <td>-0.103906</td>
      <td>-0.348037</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-0.493933</td>
      <td>-0.093299</td>
      <td>0.545031</td>
      <td>-1.640684</td>
      <td>-0.285600</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-0.869514</td>
      <td>0.190820</td>
      <td>-1.337956</td>
      <td>0.637378</td>
      <td>0.304959</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Now we have represented a large dataset of 25 variables as a set with five. Our next step is to cluster <em>those</em> values with our usual tree approach. Do that below, building the linkage tree and showing the dendrogram. This will essentially find groups of people with different personality profiles, which is an interesting finding.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Your answer here</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">shc</span><span class="o">.</span><span class="n">linkage</span><span class="p">(</span><span class="n">five</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;ward&#39;</span><span class="p">)</span>

<span class="c1"># Show</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">dendrogram</span> <span class="o">=</span> <span class="n">shc</span><span class="o">.</span><span class="n">dendrogram</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">no_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/36b297cf156b98aa3d8e49a6ab5f221211e92cdad1e11b0f9657bb7f5cdc6eab.png" src="../_images/36b297cf156b98aa3d8e49a6ab5f221211e92cdad1e11b0f9657bb7f5cdc6eab.png" />
</div>
</div>
<p>An interesting result - again one imagine cuts at various areas (30 for four clusters, 38 for three, 42 for two), but arelatively clear pattern has emerged. Test the cluster results for four, three, and two clusters, and show their silhouette coefficients.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Your answer here</span>
<span class="c1"># Make cuts</span>
<span class="n">cluster_2</span> <span class="o">=</span> <span class="n">shc</span><span class="o">.</span><span class="n">cut_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">41</span><span class="p">)</span>
<span class="n">cluster_3</span> <span class="o">=</span> <span class="n">shc</span><span class="o">.</span><span class="n">cut_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">38</span><span class="p">)</span>
<span class="n">cluster_4</span> <span class="o">=</span> <span class="n">shc</span><span class="o">.</span><span class="n">cut_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

<span class="c1"># Silhouette</span>
<span class="n">silhouette_2</span> <span class="o">=</span> <span class="n">silhouette_score</span><span class="p">(</span><span class="n">five</span><span class="p">,</span> <span class="n">cluster_2</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
<span class="n">silhouette_3</span> <span class="o">=</span> <span class="n">silhouette_score</span><span class="p">(</span><span class="n">five</span><span class="p">,</span> <span class="n">cluster_3</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
<span class="n">silhouette_4</span> <span class="o">=</span> <span class="n">silhouette_score</span><span class="p">(</span><span class="n">five</span><span class="p">,</span> <span class="n">cluster_4</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>

<span class="c1"># Print</span>
<span class="n">display</span><span class="p">(</span><span class="n">silhouette_2</span><span class="p">,</span> <span class="n">silhouette_3</span><span class="p">,</span> <span class="n">silhouette_4</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.19988331032320203
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.11861979499537914
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.12536850355775894
</pre></div>
</div>
</div>
</div>
<p>Two clusters seems to be a good bet here again, though the strength is rather weak - this suggests there are not particularly strong clusters of personality profiles in the data. Nonetheless, let us melt the data and examine the two groups, after adding the clusters to the dataset. Visualise them with a bar chart as before.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Your answer here</span>
<span class="c1"># Add cluster labels</span>
<span class="n">five</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cluster_2</span>

<span class="c1"># Melt</span>
<span class="n">plot_this</span> <span class="o">=</span> <span class="n">five</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="s1">&#39;cluster&#39;</span><span class="p">],</span>
                                    <span class="n">var_name</span><span class="o">=</span><span class="s1">&#39;trait&#39;</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s1">&#39;score&#39;</span><span class="p">)</span>

<span class="c1"># Visualise</span>
<span class="n">sns</span><span class="o">.</span><span class="n">catplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">plot_this</span><span class="p">,</span>
            <span class="n">x</span><span class="o">=</span><span class="s1">&#39;trait&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;score&#39;</span><span class="p">,</span> 
            <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;cluster&#39;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;seaborn.axisgrid.FacetGrid at 0x147961f10&gt;
</pre></div>
</div>
<img alt="../_images/b384969742efd918ebf3d1a58a5d2547cf6580bf874c2984204a99c7033e69d1.png" src="../_images/b384969742efd918ebf3d1a58a5d2547cf6580bf874c2984204a99c7033e69d1.png" />
</div>
</div>
<p>Cluster 0 are relaxed, outgoing, friendly, and conscientious. Conversely, cluster 1 are neurotic, introverted, unfriendly, and not very conscientious! Remember though, clustering is a <em>descriptive</em> technique. It is not an inferential model like OLS or factor analysis of any form, and so its findings can be very dataset specific - it is a powerful way to explore data, and we have touched only one approach to clustering here. There are in fact model-based clustering approaches that use probability distributions which can be more inferentially robust, but they too come with their own drawbacks. Taken together though, clustering is a very useful tool to have, as long as it is treated with respect.</p>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./10_Clustering"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="QPoP%20-%20Week%2010%20Workshop.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">10 - Clustering</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Fitting latent groups in data - Exercises &amp; Answers</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#applied-clustering-types-of-fertility-issues">1. Applied clustering - types of fertility issues</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#applied-clustering-grouping-penguins">2. Applied clustering - grouping penguins</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#applied-clustering-combining-efa-and-clustering">3. Applied clustering - combining EFA and clustering</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Alex Jones, Ph.D
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>